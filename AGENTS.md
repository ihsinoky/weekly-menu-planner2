# AGENTS.md

このファイルはGitHub Copilot エージェント（以下「エージェント」）が本リポジトリで適切に作業を行うためのガイドラインを示す。エージェントは本ガイドラインに従い、オープンかつ透明なプロセスでタスクを進めること。

## 目的
本リポジトリは「週次献立自動生成ツール」の開発用。Slack との対話インテーク、LLM を用いた献立生成、Notion への反映といった機能を含む。個人利用を想定しているが、開発プロセスでは GitHub の標準的なコラボレーションを活用する。

## コミュニケーション
- 変更提案は **必ずプルリクエスト (PR)** で行い、事前に **Issue** を立てて目的や背景、要件を説明する。  
- コメントや説明、コミットメッセージは **日本語** を基本とし、わかりやすく簡潔に記述する。  
- リポジトリ内での作業はオープンに共有し、直接 `main` ブランチへ push しない。
- 大きな決定や疑問点は issue/PR 内で相談し、十分な合意を得る。

## ADR（Architectural Decision Record）
- アーキテクチャやワークフローの重要な決定は `ADR_*.md` として記録する。  
- ADR では決定の背景、検討した選択肢、採用理由を記述し、コードや成果物とは別ファイルとして管理する。  
- ADR の作成・更新は PR 内でレビューを受けること。  
- 過去のADRを参照して一貫性を保つ。

## ベストプラクティスの取り込み
- Web 上の最新のベストプラクティスを積極的に取り込み、ガイドラインを改善すること。  
- `AGENTS.md` は成長するドキュメントである。必要に応じて追記・修正し、小さく明確に保つ。  
- AGENTS.mdに記載する指示は、【408059728319002†L165-L177】のように「試行錯誤を通じて好みのDo/Don’tをリスト化する」ことが推奨されている。  
- また、リストは短く保ち、必要になったら後で追加するのが良い【408059728319002†L165-L177】。


## テスト・チェックリスト
- 可能な範囲でユニットテストやスモークテストを作成し、変更が期当通り動作することを確認する。  
- PRを作成する前に `flake8` や `pylint` などの静的解析、`pytest` などのテストを実行し、エラーがないことを確認する。  
- PR の説明文には、変更内容、理由、影響範囲を簡潔に記述する。  
- PR チェックリストには lint/type check/テストが緑であること、小さな差分であることなどを含める【40805972830192002†L337-L341】。

## セーフティと権限
- エージェントが自動で行える操作は、**ファイルの読み取り・編集**、**既存スクリプトの実行**、**Issue/PR作成** に限定する。  
- 以下の操作を実行する場合は、事前にIssueやPR内でユーザーの確認を得ること:
  - 新規ライブラリのインストールや依存関係の追加。  
  - 外部サービスの設定変更。  
  - 大量のファイル削除やリポジトリ構造の大幅変更。  
- プロジェクト構造のガイドとして、`src/` 以下に実装、`docs/` に ADR 等の文書、`rules.yaml` に献立生成ルールが置かれていることを記しておく。

## 依存関係・外部API
- OpenAI API・Notion API のキーは GitHub Secrets として管理されており、コードから直接ハードコーディングしない。  
- Slack との連携や Dify インテーク用コードは `mcp_plan_d1.md` で定義された計画に従い実装を進める。  
- 外部APIやサービスへのアクセス権限を変更する場合は、必ずユーザーの確認を得る。

## 今後の更新
- `AGENTS.md`はプロジェクトの成長に合わせて更新する。新しいツールやプロセスを実装した場合、それに従いた指針を追記する。  
- 本ガイドラインに潤わない挙動が見つかった場合は Issue を立て、修正案を議論・反映する。
## コーディング方針
- 変更は **小さく焦点を絞った単位** で行い、1つのPRで複数の異なる変更をまとめない【408059728319002†L176-L186】。  
- 既存の構成 (`src/`, `main.py`, `rules.yaml`, `mcp_plan_d1.md` 等) に沿ってファイルを配置し、無関係な大規模リファクタリングは行わない。  
- `rules.yaml` や `mcp_plan_d1.md` などユーザ設定ファイルは、ユーザの指示なしに変更しない。  
- コードを追加する際は、コメントや docstring を日本語で付与し、読み手が意図を理解できるようにする。  
- 不明点や曖昧な要件がある場合は、まずIssueで確認を取る。
